## NOTE: This file is automatically generated by Mail-in-a-Box.
##       Do not edit this file. It is continually updated by
##       Mail-in-a-Box and your changes will be lost.
##
##       Mail-in-a-Box machines are not meant to be modified.
##       If you modify any system configuration you are on
##       your own --- please do not ask for help from us.

upstream php-fpm {
	server unix:/var/run/php/php8.0-fpm.sock;
}

##  $HOSTNAME hard redirects to other services
## analytics.$HOSTNAME
server {
  listen 443;
  server_name analytics.$HOSTNAME;

  root /var/www/piwik;
  index index.php;

  ssl_certificate /home/user-data/ssl/ssl_certificate.pem;
  ssl_certificate_key /home/user-data/ssl/ssl_private_key.pem;


  # Logging --
  access_log /var/log/nginx/analytics.$HOSTNAME.access.log;
  error_log /var/log/nginx/analytics.$HOSTNAME.error.log notice;

  # serve static files directly
  location ~* \.(jpg|jpeg|gif|png|css|js|ico|xml)\$ {
    access_log        off;
    log_not_found     off;
    expires           360d;
  }

  # Pass PHP scripts to PHP-FPM
  location ~* \.php$ {
    fastcgi_index   index.php;
    #fastcgi_pass    127.0.0.1:9000;
    fastcgi_pass    unix:/var/run/php/piwik.socket;
    include         fastcgi_params;
    fastcgi_param   SCRIPT_FILENAME    $document_root$fastcgi_script_name;
    fastcgi_param   SCRIPT_NAME        $fastcgi_script_name;
  }
}